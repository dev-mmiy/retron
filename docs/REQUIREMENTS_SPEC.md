# ReTron OS - 要件定義書

> **ドキュメント種別**: 要件定義ドキュメント  
> **対象読者**: プロジェクトマネージャー、システム設計者、ステークホルダー  
> **関連ドキュメント**: [FUNCTIONAL_REQUIREMENTS.md](FUNCTIONAL_REQUIREMENTS.md), [NON_FUNCTIONAL_REQUIREMENTS.md](NON_FUNCTIONAL_REQUIREMENTS.md), [ARCHITECTURE.md](ARCHITECTURE.md)

## ドキュメント情報

| 項目 | 内容 |
|------|------|
| **ドキュメント名** | ReTron OS 要件定義書 |
| **バージョン** | 1.0 |
| **作成日** | 2024年 |
| **最終更新日** | 2024年 |
| **作成者** | - |
| **承認者** | - |
| **ステータス** | 草案 |

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
ReTron OS

### 1.2 プロジェクトの目的
スマートフォンおよびロボット向けの組み込みオペレーティングシステムを開発する。将来的には、このOSをベースにラップトップ向けOSを開発する。

### 1.3 プロジェクトの背景
- 組み込みシステム向けのリアルタイムOSの需要
- TRONベースのOSの実装
- Rustによる安全性とパフォーマンスの両立
- 商用利用可能なライセンス

### 1.4 プロジェクトの範囲
- **含まれる範囲**:
  - T-Kernelベースのカーネル実装
  - Rustによるシステムサービス実装
  - ファイルシステム実装
  - ネットワークスタック実装
  - UI層実装
  - ROS2互換API実装
  - セキュリティ機能実装
  - 国際化対応（英語・日本語）

- **含まれない範囲**:
  - POSIX互換レイヤー
  - 既存OS（Linux、FreeBSDなど）の統合
  - 特定のハードウェアプラットフォームへの最適化（初期段階）
  - アプリケーション開発環境（アプリストア、SDKなど）: 別プロジェクトとして扱う

---

## 2. ターゲットプラットフォーム

### 2.1 初期ターゲット（優先順位）

**優先順位**: ARMアーキテクチャを優先

**理由**:
- 開発ボードの入手が容易
- 豊富なドキュメントとコミュニティサポート
- 開発環境の構築が容易

#### 2.1.1 ARMアーキテクチャ（優先）
- **スマートフォン**: ARM Cortex-A シリーズ（ARMv8-A）
- **ロボット**: ARM Cortex-A/M シリーズ

#### 2.1.2 RISC-Vアーキテクチャ（将来対応）
- **ロボット**: RISC-V（ARM実装後に検討）

### 2.2 ARM開発環境（優先）

**注意**: ARMアーキテクチャを優先して開発を進める。

#### 2.2.1 仮想環境（ARM）

**推奨: QEMU `virt` machine（ARM Generic AArch64）**

**推奨理由**:
- ✅ **標準的**: ARM Generic AArch64仕様に準拠（癖がない）
- ✅ **移植性**: 他のARMボードへの移植が容易
- ✅ **広く使用**: 多くのOS開発プロジェクトで使用されている
- ✅ **無料**: オープンソースで無料
- ✅ **T-Kernel対応**: T-KernelはQEMU上での動作をサポート

**仕様**:
- **CPU**: ARM Generic AArch64（ARMv8-A）
- **メモリ**: 任意（推奨: 1GB以上）
- **ストレージ**: 仮想ディスク（推奨: 16GB以上）
- **ネットワーク**: 仮想ネットワーク（標準的なデバイス）
- **表示**: 仮想フレームバッファ（標準的なデバイス）

**QEMUコマンド例**:
```bash
qemu-system-aarch64 \
  -machine virt \
  -cpu cortex-a53 \
  -m 1G \
  -drive file=retron.img,format=raw \
  -netdev user,id=net0 \
  -device virtio-net-device,netdev=net0 \
  -nographic
```

**メリット**:
- 開発初期からすぐに開始可能（ハードウェア不要）
- デバッグが容易（GDB統合）
- 標準的なデバイスモデル（移植が容易）
- 他のARMボードへの移植が容易

#### 2.2.2 物理ボード（ARM）

##### 2.2.2.1 第一候補: BeagleBone Black または BeagleBone AI

**推奨理由**:
- ✅ **標準的**: TI AM335x（ARM Cortex-A8）は標準的なARM SoC
- ✅ **移植性**: 標準的なARMアーキテクチャ（癖がない）
- ✅ **入手性**: 広く流通しており入手が容易
- ✅ **ドキュメント**: 充実したドキュメントとコミュニティサポート
- ✅ **T-Kernel対応**: T-Kernelのサポートが充実している可能性が高い

**BeagleBone Black 仕様**:
- **CPU**: TI AM335x（ARM Cortex-A8、1コア、1GHz）
- **メモリ**: 512MB DDR3
- **ストレージ**: microSDカード、4GB eMMC（内蔵）
- **ネットワーク**: 10/100 イーサネット
- **表示**: HDMI（オプション）
- **価格**: 約$55

**BeagleBone AI 仕様**:
- **CPU**: TI AM5729（ARM Cortex-A15、2コア、1.5GHz）
- **メモリ**: 1GB DDR3
- **ストレージ**: microSDカード、16GB eMMC（内蔵）
- **ネットワーク**: ギガビットイーサネット、WiFi
- **表示**: HDMI
- **価格**: 約$100

**注意点**:
- BeagleBone Blackはやや古いが、標準的で移植が容易
- BeagleBone AIはより高性能だが、価格が高い

##### 2.2.2.2 第二候補: Renesas RZ/G1E スタータキット

**推奨理由**:
- ✅ **T-Kernel対応**: T-Kernel 2.0ベースの「OpenTK」が対応
- ✅ **標準的**: ARM Cortex-A7は標準的なARMアーキテクチャ
- ✅ **入手性**: ルネサスの公式サイトや正規代理店から入手可能

**仕様**:
- **CPU**: Renesas RZ/G1E（ARM Cortex-A7、2コア）
- **メモリ**: 512MB-1GB
- **ストレージ**: microSDカード
- **ネットワーク**: イーサネット
- **価格**: 要問い合わせ

**注意点**:
- T-Kernelのサポートが充実している
- 入手がやや困難な場合がある

##### 2.2.2.3 非推奨: Raspberry Pi シリーズ

**非推奨理由**:
- ❌ **独自性が高い**: VideoCore GPUなど独自の部分が多い
- ❌ **移植が困難**: 他のボードへの移植が困難
- ❌ **癖がある**: Broadcom SoCの独自仕様が多い

**ただし、以下の場合は検討可能**:
- 特定の用途でRaspberry Piが必要な場合
- 移植性を優先しない場合

#### 2.2.3 ARM開発環境の選定結果（優先）

**推奨アプローチ**:

1. **初期開発（Phase 0-1）**: QEMU `virt` machine（ARM）
   - 仮想環境で開発を開始
   - 標準的なARMデバイスモデルで開発
   - ハードウェア不要で開発を開始可能

2. **検証・テスト（Phase 2以降）**: BeagleBone Black または BeagleBone AI
   - 物理ボードでの動作確認
   - 標準的なARM SoCで移植性を確保
   - 他のARMボードへの移植が容易

**選定結果**:
- **仮想環境**: **QEMU `virt` machine（ARM Generic AArch64）**
- **物理ボード**: **BeagleBone Black**（初期検証用）または **BeagleBone AI**（高性能が必要な場合）

### 2.3 RISC-V開発環境（将来対応）

**注意**: RISC-Vは将来対応として検討。ARM実装が完了した後に検討する。

#### 2.3.1 仮想環境（RISC-V）

**推奨: QEMU `virt` machine（RISC-V）**

**推奨理由**:
- ✅ **標準的**: RISC-V Generic仕様に準拠（癖がない）
- ✅ **移植性**: 他のRISC-Vボードへの移植が容易
- ✅ **広く使用**: 多くのOS開発プロジェクトで使用されている
- ✅ **無料**: オープンソースで無料

**仕様**:
- **CPU**: RISC-V 64-bit（RV64GC）
- **メモリ**: 任意（推奨: 1GB以上）
- **ストレージ**: 仮想ディスク（推奨: 16GB以上）
- **ネットワーク**: 仮想ネットワーク（標準的なデバイス）
- **表示**: 仮想フレームバッファ（標準的なデバイス）

**QEMUコマンド例**:
```bash
qemu-system-riscv64 \
  -machine virt \
  -cpu rv64 \
  -m 1G \
  -drive file=retron.img,format=raw \
  -netdev user,id=net0 \
  -device virtio-net-device,netdev=net0 \
  -nographic
```

#### 2.3.2 物理ボード（RISC-V）

##### 2.3.2.1 第一候補: HiFive Unleashed / HiFive Unmatched

**推奨理由**:
- ✅ **標準的**: SiFive社製（RISC-Vのリファレンスプラットフォーム）
- ✅ **移植性**: 標準的なRISC-Vアーキテクチャ（癖がない）
- ✅ **高性能**: アプリケーションプロセッサ向け
- ✅ **ドキュメント**: 充実したドキュメントとコミュニティサポート

**HiFive Unleashed 仕様**:
- **CPU**: SiFive Freedom U540（RISC-V 64-bit、5コア、1.5GHz）
- **メモリ**: 8GB DDR4
- **ストレージ**: microSDカード、M.2 SSD
- **ネットワーク**: ギガビットイーサネット
- **表示**: HDMI
- **価格**: 約$1,000（生産終了の可能性あり）

**HiFive Unmatched 仕様**:
- **CPU**: SiFive Freedom U740（RISC-V 64-bit、4コア、1.4GHz）
- **メモリ**: 16GB DDR4
- **ストレージ**: microSDカード、M.2 SSD
- **ネットワーク**: ギガビットイーサネット、WiFi
- **表示**: HDMI
- **価格**: 約$665

**注意点**:
- 高性能だが価格が高い
- 入手がやや困難な場合がある

##### 2.3.2.2 第二候補: BeagleV

**推奨理由**:
- ✅ **標準的**: BeagleBoard.org財団が提供（標準的な設計）
- ✅ **移植性**: 標準的なRISC-Vアーキテクチャ
- ✅ **入手性**: 比較的入手が容易
- ✅ **ドキュメント**: BeagleBoard.orgのコミュニティサポート

**仕様**:
- **CPU**: StarFive JH7100（RISC-V 64-bit、2コア、1.5GHz）
- **メモリ**: 2GB/4GB DDR3
- **ストレージ**: microSDカード、eMMC
- **ネットワーク**: ギガビットイーサネット、WiFi
- **表示**: HDMI、MIPI DSI
- **価格**: 約$150-200

**注意点**:
- 比較的入手が容易
- 価格が適切

##### 2.3.2.3 第三候補: VisionFive 2

**推奨理由**:
- ✅ **標準的**: StarFive社製（標準的なRISC-V設計）
- ✅ **入手性**: 比較的入手が容易
- ✅ **価格**: 比較的低価格

**仕様**:
- **CPU**: StarFive JH7110（RISC-V 64-bit、4コア、1.5GHz）
- **メモリ**: 2GB/4GB/8GB LPDDR4
- **ストレージ**: microSDカード、eMMC、M.2 SSD
- **ネットワーク**: ギガビットイーサネット、WiFi
- **表示**: HDMI、MIPI DSI
- **価格**: 約$100-200

**注意点**:
- 比較的新しいボード
- 入手が容易

##### 2.3.2.4 非推奨: 低性能MCUボード

**Longan Nano、Kendryte K210など**:
- ❌ **性能不足**: MCU向けで、OS開発には性能が不足
- ❌ **用途が異なる**: 組み込みMCU向けで、アプリケーションプロセッサ向けではない

**ただし、以下の場合は検討可能**:
- 特定の低性能用途で必要な場合
- プロトタイピング用途

#### 2.3.3 RISC-V開発環境の選定結果（将来対応）

**推奨アプローチ**:

1. **初期開発（仮想環境）**: QEMU `virt` machine（RISC-V）
   - 仮想環境で開発を開始
   - 標準的なRISC-Vデバイスモデルで開発
   - ハードウェア不要で開発を開始可能

2. **検証・テスト（物理ボード）**: BeagleV または VisionFive 2
   - 物理ボードでの動作確認
   - 標準的なRISC-V SoCで移植性を確保
   - 他のRISC-Vボードへの移植が容易

**選定結果（将来対応）**:
- **仮想環境**: **QEMU `virt` machine（RISC-V 64-bit）**
- **物理ボード**: **BeagleV** または **VisionFive 2**（価格と入手性を考慮）

### 2.4 将来のターゲット
- **ラップトップ**: x86_64、ARM64

### 2.5 ハードウェア要件（最小構成）

#### 2.5.1 最小要件（仮想環境・物理ボード共通）
- **CPU**: ARM Cortex-A8以上（ARMv7-A）または ARM Cortex-A53以上（ARMv8-A）
- **メモリ**: 512MB以上（推奨: 1GB以上）
- **ストレージ**: 4GB以上（推奨: 16GB以上）
- **ネットワーク**: イーサネット（仮想環境では仮想ネットワーク）
- **表示**: フレームバッファ対応（推奨: タッチスクリーン対応）

#### 2.5.2 推奨要件（開発用）
- **CPU**: ARM Cortex-A15以上（ARMv7-A）または ARM Cortex-A53以上（ARMv8-A）
- **メモリ**: 1GB以上（推奨: 2GB以上）
- **ストレージ**: 16GB以上（推奨: 32GB以上）
- **ネットワーク**: ギガビットイーサネット（物理ボードの場合）
- **表示**: HDMI、フレームバッファ対応

### 2.6 開発環境選定の判断基準

| 基準 | 重要度 | QEMU virt | BeagleBone | Raspberry Pi |
|------|--------|-----------|------------|--------------|
| 標準性 | 高 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| 移植性 | 高 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| 入手容易性 | 中 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| ドキュメント | 中 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 価格 | 中 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| コミュニティ | 低 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |

**選定結果**:
- **仮想環境**: **QEMU `virt` machine（ARM Generic AArch64）** - 標準的で移植性が高い
- **物理ボード**: **BeagleBone Black** または **BeagleBone AI** - 標準的で移植性が高い

---

## 3. ステークホルダー

### 3.1 主要ステークホルダー
- プロジェクトマネージャー
- システム設計者
- 開発者
- エンドユーザー
  - **スマートフォン**: 一般消費者、企業など
  - **ロボット**: 一般消費者、企業など

### 3.2 ステークホルダーの要件
- **開発者**: 使いやすいAPI、充実したドキュメント
- **エンドユーザー**: 安定性、セキュリティ、パフォーマンス
- **プロジェクトマネージャー**: スケジュール遵守、予算内での開発

---

## 4. ユースケース概要

### 4.1 スマートフォン向けユースケース

#### 4.1.1 対象ユーザー
- **一般消費者**: 個人向けスマートフォン利用者
- **企業**: 企業向けスマートフォン利用者

#### 4.1.2 主要アプリケーション（初期リリース）

**必須機能（初期リリース）**:
1. **メッセージアプリケーション**
   - テキストメッセージの送受信
   - ネットワーク経由の通信
   - セキュアなデータ保存

2. **ブラウザアプリケーション**
   - Webページの表示
   - ネットワーク通信（HTTP/HTTPS）
   - タッチ入力による操作

**後回し機能**:
3. **カメラアプリケーション**
   - 写真撮影
   - 画像保存
   - （Phase 4以降で実装）

#### 4.1.3 基本機能
- タッチ入力の処理
- グラフィック表示
- ネットワーク通信
- セキュアなデータ保存

#### 4.1.4 アプリケーション開発環境

**注意**: 他の開発者がアプリを提供できるようにする機能（アプリストア、SDKなど）は、**別プロジェクト**として扱う。ReTron OSの初期リリースには含めない。

### 4.2 ロボット向けユースケース

#### 4.2.1 対象ユーザー
- **一般消費者**: 個人向けロボット利用者
- **企業**: 企業向けロボット利用者

#### 4.2.2 主要ロボットタイプ
1. **自律移動ロボット**
   - 自律的な移動制御
   - センサーデータの処理（LiDAR、カメラなど）
   - 経路計画とナビゲーション

2. **マニピュレーター**
   - アームの制御
   - 物体の把持と操作
   - 精密な動作制御

3. **ドローン**
   - 飛行制御
   - センサーデータの処理（GPS、IMU、カメラなど）
   - 自律飛行とナビゲーション

#### 4.2.3 主要機能
- ROS2互換のロボットアプリケーションの実行
- リアルタイム制御
- センサーデータの処理
- アクチュエータ制御
- ネットワーク経由の通信

#### 4.2.4 ROS2機能の優先度

**必須機能（初期リリース）**:
- **トピック通信（パブリッシュ/サブスクライブ）**
  - センサーデータの送受信
  - コマンドの送受信
  - 状態情報の送受信
- **基本的なメッセージ型のサポート**
  - 標準メッセージ型（std_msgs、geometry_msgsなど）
- **リアルタイム性**
  - ロボット操作に必要なリアルタイム制御

**後回し機能**:
- サービス（Service）
- アクション（Action）
- 高度なリアルタイム機能（QoS設定など）

---

## 5. 機能要件の概要

詳細は [FUNCTIONAL_REQUIREMENTS.md](FUNCTIONAL_REQUIREMENTS.md) を参照。

### 5.1 主要機能カテゴリ
1. **カーネル機能**: タスク管理、メモリ管理、同期制御、割り込み処理
2. **システムサービス**: ファイルシステム、ネットワークスタック、デバイス管理
3. **UI層**: グラフィックレンダリング、入力処理、ウィンドウ管理
4. **アプリケーションAPI**: ROS2互換API、国際化API、セキュリティAPI
5. **デバイスドライバ**: グラフィック、入力、ストレージ、ネットワーク

---

## 6. 非機能要件の概要

詳細は [NON_FUNCTIONAL_REQUIREMENTS.md](NON_FUNCTIONAL_REQUIREMENTS.md) を参照。

### 6.1 主要非機能要件カテゴリ
1. **パフォーマンス**: リアルタイム性、レスポンス時間、スループット
2. **セキュリティ**: アクセス制御、暗号化、サンドボックス
3. **信頼性**: 可用性、障害回復、データ整合性
4. **保守性**: コード品質、ドキュメント、テスト
5. **移植性**: プラットフォーム非依存、アーキテクチャ対応
6. **拡張性**: モジュール化、プラグイン機構
7. **互換性**: ROS2互換、標準規格準拠

---

## 7. 制約事項

### 7.1 技術的制約
- T-Kernelをカーネルとして使用
- Rustをシステムサービス実装に使用
- 商用利用可能なライセンスを採用
- POSIX互換レイヤーは提供しない
- 著作権上利用が難しいライブラリは使用しない

### 7.2 スケジュール制約
- Phase 0: 2-3ヶ月
- Phase 1-8: 合計26-37ヶ月（並行開発により20-30ヶ月に短縮可能）
- 生成AIの活用により開発期間の短縮を目指す

### 7.3 法的制約
- ライセンス要件: 商用利用可能なライセンスを採用
- 知的財産権: 他社のライセンスを支払う必要があるものを利用する際は、事前に確認が必要
- セキュリティ規制: 特定の業界規制は適用されない

---

## 8. 前提条件

### 8.1 技術的前提条件
- T-Kernelの利用可能性
- Rustツールチェーンの利用可能性
- ターゲットハードウェアの利用可能性
- QEMUなどの仮想環境の利用可能性
- 生成AIツールの利用可能性（開発効率化のため）

---

## 9. リスクと課題

### 9.1 技術的リスク
- T-Kernel統合の複雑性
- Rust FFIの安全性
- パフォーマンス要件の達成
- ハードウェア互換性

### 9.2 プロジェクトリスク
- スケジュール遅延
- リソース不足
- 要件変更

### 9.3 リスク軽減策
- プロトタイプによる早期検証
- 段階的な開発アプローチ
- 十分なテストとコードレビュー

---

## 10. 成功基準

### 10.1 機能的な成功基準
- すべての主要機能が実装される
- ROS2互換APIが動作する
- 国際化（英語・日本語）が機能する
- セキュリティ機能が動作する

### 10.2 非機能的な成功基準
- リアルタイム性要件を満たす
- セキュリティ要件を満たす
- パフォーマンス要件を満たす
- 商用利用可能なライセンスでリリース

---

## 11. 用語集

| 用語 | 説明 |
|------|------|
| **T-Kernel** | TRON標準の次世代カーネル |
| **ROS2** | Robot Operating System 2 |
| **FFI** | Foreign Function Interface |
| **VFS** | Virtual File System |
| **HAL** | Hardware Abstraction Layer |
| **i18n** | Internationalization（国際化） |

---

## 12. 参照ドキュメント

- [FUNCTIONAL_REQUIREMENTS.md](FUNCTIONAL_REQUIREMENTS.md) - 機能要件定義書
- [NON_FUNCTIONAL_REQUIREMENTS.md](NON_FUNCTIONAL_REQUIREMENTS.md) - 非機能要件定義書
- [ARCHITECTURE.md](ARCHITECTURE.md) - システムアーキテクチャ設計
- [TKERNEL_ARCHITECTURE.md](TKERNEL_ARCHITECTURE.md) - T-Kernelベースアーキテクチャ設計
- [DEVELOPMENT_PROCESS.md](DEVELOPMENT_PROCESS.md) - 開発工程標準プロセス

---

## 13. 承認

| 役割 | 名前 | 署名 | 日付 |
|------|------|------|------|
| プロジェクトマネージャー | - | - | - |
| システム設計者 | - | - | - |
| ステークホルダー | - | - | - |

---

## 変更履歴

| バージョン | 日付 | 変更内容 | 変更者 |
|-----------|------|----------|--------|
| 1.0 | 2024年 | 初版作成 | - |

