# UART書き込みがデバイスに到達しない問題

## 発見事項

### ✅ 正常に動作していること
- `str x0, [x1]`命令が実行されている（`$x1 = 0x9000000`, `$x0 = 0x11`）
- UARTCR = 0x301（正常）
- `uart_pl011_init`からの書き込み（UARTCR = 0x301）は正常に動作している

### ❌ 問題
- `str`命令実行後も、UARTDR = 0x0のまま
- UARTFR = 0x90のまま（変化なし）
- QEMUのシリアル出力に何も表示されない

## 考えられる原因

### 1. メモリマッピングの問題
0x09000000への書き込みが、QEMUのUARTデバイスに正しくマッピングされていない可能性があります。

### 2. キャッシュの問題
書き込みがキャッシュに留まっている可能性があります（ただし、メモリバリア`dmb sy`は実行されている）。

### 3. QEMUのUARTデバイスの問題
QEMUのPL011 UARTデバイスが、UARTDRへの書き込みを受け付けていない可能性があります。

### 4. UARTDRの読み取り動作
UARTDRは書き込み専用レジスタの可能性があります。読み取ると常に0x0を返す可能性がありますが、実際には書き込みは行われている可能性があります。

## 確認手順

### ステップ1: QEMUの起動オプションを確認
```bash
cat run-tkernel-qemu.sh
```

### ステップ2: QEMUのログを確認
QEMUの起動時にエラーメッセージがないか確認します。

### ステップ3: 別の方法でUARTDRに書き込んでテスト
GDBから直接UARTDRに書き込んで、QEMUのシリアル出力に表示されるか確認します。

### ステップ4: メモリマッピングを確認
0x09000000が正しくUARTデバイスにマッピングされているか確認します。

## 解決方法

### 方法1: QEMUの起動オプションを確認
`-serial stdio`が正しく設定されているか確認します。

### 方法2: メモリマッピングを確認
QEMU virt machineのメモリマッピングを確認し、0x09000000が正しくUARTデバイスにマッピングされているか確認します。

### 方法3: キャッシュを無効化
デバイスメモリへのアクセス時にキャッシュを無効化する必要があるかもしれません。
